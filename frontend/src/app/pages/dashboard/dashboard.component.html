<!-- Dashboard Component - Complete Phase 3 with Filtering, Sorting, Search -->
<div class="dashboard-container">
  <!-- ===== HEADER ===== -->
  <header class="dashboard-header">
    <div class="header-left">
      <h1>ğŸ¥¬ {{ 'app.title' | translate }}</h1>
    </div>
    <div class="header-right">
      <app-language-switcher></app-language-switcher>
      <span class="user-info">ğŸ‘‹ {{ userName() }}</span>
      <button class="btn-logout" (click)="authService.logout()">{{ 'auth.logout' | translate }}</button>
    </div>
  </header>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="dashboard-content">
    <!-- ===== STATISTICS ===== -->
    <div class="stats-container">
      <div class="stat-card">
        <h3>{{ 'dashboard.totalGroceries' | translate }}</h3>
        <p class="stat-number">{{ groceries().length }}</p>
      </div>
      <div class="stat-card">
        <h3>{{ 'dashboard.expiringSoon' | translate }}</h3>
        <p class="stat-number">{{ expiringCount() }}</p>
      </div>
      <div class="stat-card">
        <h3>{{ 'dashboard.expired' | translate }}</h3>
        <p class="stat-number">{{ expiredCount() }}</p>
      </div>
    </div>

    <!-- ===== FILTER & SEARCH BAR ===== -->
    <div class="filter-search-bar">
      <!-- Add Button -->
      <button class="btn btn-primary" (click)="openAddModal()" [disabled]="isLoading()">
        â• {{ 'dashboard.addGrocery' | translate }}
      </button>

      <!-- Category Filter -->
      <select 
        class="filter-select"
        [value]="selectedCategory()"
        (change)="onCategoryChange($event)"
      >
        <option value="all">{{ 'dashboard.filterByCategory' | translate }}</option>
        <option value="Dairy">ğŸ¥› {{ 'categories.dairy' | translate }}</option>
        <option value="Vegetables">ğŸ¥¬ {{ 'categories.vegetables' | translate }}</option>
        <option value="Fruits">ğŸ {{ 'categories.fruits' | translate }}</option>
        <option value="Meat">ğŸ– {{ 'categories.meat' | translate }}</option>
        <option value="Pantry">ğŸ“¦ {{ 'categories.pantry' | translate }}</option>
        <option value="Frozen">â„ï¸ {{ 'categories.frozen' | translate }}</option>
        <option value="Other">ğŸ“ {{ 'categories.other' | translate }}</option>
      </select>

      <!-- Sort Options -->
      <select 
        class="filter-select"
        [value]="sortBy()"
        (change)="handleSortChange($event)"
      >
        <option value="expiration-asc">ğŸ“… {{ 'dashboard.sortBy' | translate }}</option>
        <option value="expiration-desc">ğŸ“… Latest First</option>
      </select>

      <!-- Search Box -->
      <input 
        type="text"
        class="search-input"
        [placeholder]="'dashboard.search' | translate"
        [value]="searchQuery()"
        (input)="onSearchChange($any($event.target).value)"
      />

      <!-- Clear Filters Button -->
      <button 
        class="btn btn-secondary btn-sm"
        (click)="clearAllFilters()"
        *ngIf="selectedCategory() !== 'all' || searchQuery() !== ''"
      >
        ğŸ§¹ {{ 'dashboard.clearFilters' | translate }}
      </button>
    </div>

    <!-- ===== LOADING STATE ===== -->
    <div *ngIf="isLoading()" class="loading-state">
      â³ Loading groceries...
    </div>

    <!-- ===== EMPTY STATE - NO MATCHES ===== -->
    <div *ngIf="!isLoading() && filteredGroceries().length === 0 && groceries().length > 0" class="empty-state">
      <p>ğŸ” No groceries match your filters. Try adjusting your search!</p>
    </div>

    <!-- ===== EMPTY STATE - NO DATA ===== -->
    <div *ngIf="!isLoading() && groceries().length === 0" class="empty-state">
      <p>ğŸ“­ No groceries yet. Click "{{ 'dashboard.addGrocery' | translate }}" to get started!</p>
    </div>

    <!-- ===== GROCERIES GRID ===== -->
    <div *ngIf="!isLoading() && filteredGroceries().length > 0" class="groceries-grid">
      <div *ngFor="let grocery of filteredGroceries()" 
           class="grocery-card"
           [style.border-left-color]="getStatusColor(getStatus(grocery.expirationDate))">
        
        <!-- Card Header -->
        <div class="card-header">
          <h3>{{ grocery.name }}</h3>
          <span class="badge" [ngClass]="getStatus(grocery.expirationDate)">
            {{ getStatus(grocery.expirationDate) | uppercase }}
          </span>
        </div>

        <!-- Card Details -->
        <div class="card-details">
          <p><strong>{{ 'dashboard.category' | translate }}:</strong> {{ grocery.category }}</p>
          <p>
            <strong>{{ 'dashboard.expirationDate' | translate }}:</strong> {{ grocery.expirationDate | date: 'MMM dd, yyyy' }} 
            <span class="days-until" [ngClass]="getStatus(grocery.expirationDate)">
              ({{ getDaysUntilExpiry(grocery.expirationDate) }} days)
            </span>
          </p>
          <p><strong>{{ 'dashboard.quantity' | translate }}:</strong> {{ grocery.quantity }} {{ grocery.unit }}</p>
          <p><strong>{{ 'dashboard.location' | translate }}:</strong> {{ grocery.location }}</p>
          <p *ngIf="grocery.notes"><strong>{{ 'dashboard.notes' | translate }}:</strong> {{ grocery.notes }}</p>
        </div>

        <!-- Card Actions -->
        <div class="card-actions">
          <button class="btn btn-sm btn-edit" (click)="openEditModal(grocery)">
            âœï¸ {{ 'dashboard.edit' | translate }}
          </button>
          <button class="btn btn-sm btn-delete" (click)="openDeleteConfirm(grocery)">
            ğŸ—‘ï¸ {{ 'dashboard.delete' | translate }}
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- ===== ADD/EDIT MODAL ===== -->
  <div *ngIf="showAddModal() || showEditModal()" class="modal-overlay" (click)="closeModals()">
    <div class="modal" (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="modal-header">
        <h2>{{ showEditModal() ? ('âœï¸ ' + ('dashboard.edit' | translate) + ' ' + ('dashboard.name' | translate | lowercase)) : ('â• ' + ('dashboard.addGrocery' | translate)) }}</h2>
        <button class="btn-close" (click)="closeModals()">âœ•</button>
      </div>

      <!-- Modal Form -->
      <form [formGroup]="groceryForm" class="modal-form">
        <!-- Name (Required) -->
        <div class="form-group">
          <label>{{ 'dashboard.name' | translate }} *</label>
          <input 
            type="text" 
            formControlName="name" 
            placeholder="e.g., Milk, Tomato, Chicken"
            class="form-input"
          />
          <small *ngIf="groceryForm.get('name')?.hasError('required')" class="error">
            {{ 'dashboard.requiredField' | translate }}
          </small>
          <small *ngIf="groceryForm.get('name')?.hasError('minlength')" class="error">
            {{ 'dashboard.minLength' | translate: { min: 2 } }}
          </small>
        </div>

        <!-- Category -->
        <div class="form-group">
          <label>{{ 'dashboard.category' | translate }}</label>
          <select formControlName="category" class="form-input">
            <option value="Dairy">ğŸ¥› {{ 'categories.dairy' | translate }}</option>
            <option value="Vegetables">ğŸ¥¬ {{ 'categories.vegetables' | translate }}</option>
            <option value="Fruits">ğŸ {{ 'categories.fruits' | translate }}</option>
            <option value="Meat">ğŸ– {{ 'categories.meat' | translate }}</option>
            <option value="Pantry">ğŸ“¦ {{ 'categories.pantry' | translate }}</option>
            <option value="Frozen">â„ï¸ {{ 'categories.frozen' | translate }}</option>
            <option value="Other">ğŸ“ {{ 'categories.other' | translate }}</option>
          </select>
        </div>

        <!-- Expiration Date (Required) -->
        <div class="form-group">
          <label>{{ 'dashboard.expirationDate' | translate }} *</label>
          <input 
            type="date" 
            formControlName="expirationDate"
            class="form-input"
          />
          <small *ngIf="groceryForm.get('expirationDate')?.hasError('required')" class="error">
            {{ 'dashboard.requiredField' | translate }}
          </small>
        </div>

        <!-- Quantity & Unit -->
        <div class="form-row">
          <div class="form-group">
            <label>Quantity</label>
            <input 
              type="number" 
              formControlName="quantity" 
              min="1"
              class="form-input"
            />
          </div>
          <div class="form-group">
            <label>{{ 'dashboard.unit' | translate }}</label>
            <select formControlName="unit" class="form-input">
              <option value="pieces">{{ 'units.pieces' | translate }}</option>
              <option value="L">{{ 'units.l' | translate }} ({{ 'units.l' | translate | lowercase }})</option>
              <option value="ml">{{ 'units.ml' | translate }}</option>
              <option value="kg">{{ 'units.kg' | translate }}</option>
              <option value="g">{{ 'units.g' | translate }}</option>
              <option value="packs">{{ 'units.packs' | translate }}</option>
            </select>
          </div>
        </div>

        <!-- Location -->
        <div class="form-group">
          <label>{{ 'dashboard.location' | translate }}</label>
          <select formControlName="location" class="form-input">
            <option value="Fridge">â„ï¸ {{ 'locations.fridge' | translate }}</option>
            <option value="Freezer">ğŸ§Š {{ 'locations.freezer' | translate }}</option>
            <option value="Pantry">ğŸ“¦ {{ 'locations.pantry' | translate }}</option>
            <option value="Counter">ğŸ½ï¸ {{ 'locations.counter' | translate }}</option>
          </select>
        </div>

        <!-- Notes -->
        <div class="form-group">
          <label>{{ 'dashboard.notes' | translate }}</label>
          <textarea 
            formControlName="notes" 
            placeholder="Any additional notes..."
            class="form-input"
            rows="3"
          ></textarea>
        </div>

        <!-- Modal Actions -->
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeModals()">
            {{ 'dashboard.cancel' | translate }}
          </button>
          <button 
            type="button" 
            class="btn btn-primary"
            (click)="showEditModal() ? updateGrocery() : addGrocery()"
            [disabled]="groceryForm.invalid || isLoading()"
          >
            {{ showEditModal() ? ('âœï¸ ' + ('dashboard.save' | translate)) : ('â• ' + ('dashboard.addGrocery' | translate)) }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== DELETE CONFIRMATION MODAL ===== -->
  <div *ngIf="showDeleteConfirm()" class="modal-overlay" (click)="closeModals()">
    <div class="modal modal-sm" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>ğŸ—‘ï¸ {{ 'dashboard.deleteConfirmTitle' | translate }}</h2>
        <button class="btn-close" (click)="closeModals()">âœ•</button>
      </div>
      
      <div class="modal-body">
        <p>{{ 'dashboard.confirmDelete' | translate }} <strong>{{ selectedGrocery()?.name }}</strong>?</p>
        <p class="warning">This action cannot be undone.</p>
      </div>

      <div class="modal-actions">
        <button class="btn btn-secondary" (click)="closeModals()">
          {{ 'dashboard.cancel' | translate }}
        </button>
        <button class="btn btn-delete" (click)="deleteGrocery()" [disabled]="isLoading()">
          ğŸ—‘ï¸ {{ 'dashboard.delete' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>